// Taxman - Hybrid Taxonomy Management System
import { LineEdit, Button, StandardListView, GridBox, HorizontalBox, VerticalBox, ScrollView } from "std-widgets.slint";

export component MainWindow inherits Window {
    // Window properties
    in property <string> window-title <=> root.title;
    in property <string> status-message;
    in property <string> taxonomy-description;
    in property <string> hierarchy-root;
    in property <[StandardListViewItem]> items-list;
    in property <string> facet-dimensions-text;

    // Selected item properties
    in-out property <int> selected-item-index: -1;
    in property <string> selected-item-name;
    in property <string> selected-item-path;
    in property <string> selected-item-facets;

    // Filter properties
    in-out property <string> genus-filter-text: "";
    in-out property <string> facet-filter-text: "";
    in property <string> active-filters-text: "";

    // File operation callbacks
    callback file-open();
    callback file-save();
    callback file-save-as();
    callback file-new();

    // Item selection callback
    callback item-selected(int);

    // Sort callback
    callback sort-by-name();

    // Filter callbacks
    callback apply-filters();
    callback clear-filters();

    min-width: 1000px;
    min-height: 700px;

    VerticalBox {
        // Toolbar
        HorizontalBox {
            height: 40px;
            padding: 8px;
            spacing: 8px;

            Button {
                text: "New";
                clicked => { root.file-new(); }
            }

            Button {
                text: "Open...";
                clicked => { root.file-open(); }
            }

            Button {
                text: "Save";
                clicked => { root.file-save(); }
            }

            Button {
                text: "Save As...";
                clicked => { root.file-save-as(); }
            }

            Rectangle {
                // Spacer
                horizontal-stretch: 1;
            }

            Text {
                text: root.taxonomy-description != "" ? root.taxonomy-description : "No taxonomy loaded";
                vertical-alignment: center;
                color: #555;
                font-size: 12px;
            }
        }

        // Main 3-panel layout
        HorizontalBox {
            spacing: 0;

            // Left panel - Hierarchy Tree
            Rectangle {
                width: 250px;
                background: #fafafa;
                border-width: 1px;
                border-color: #ddd;

                VerticalBox {

                // Panel header
                Rectangle {
                    height: 30px;
                    background: #e8e8e8;

                    HorizontalBox {
                        padding: 6px;

                        Text {
                            text: "Hierarchy";
                            font-weight: 700;
                            vertical-alignment: center;
                            color: #000;
                        }
                    }
                }

                // Panel content
                ScrollView {
                    VerticalBox {
                        padding: 8px;

                        if root.hierarchy-root != "" : VerticalBox {
                            spacing: 4px;

                            Text {
                                text: "Root:";
                                font-size: 10px;
                                color: #666;
                            }

                            Text {
                                text: root.hierarchy-root;
                                font-weight: 700;
                                color: #000;
                            }

                            Rectangle {
                                height: 8px;
                            }

                            Text {
                                text: "Hierarchy tree will be implemented in Phase 4";
                                font-size: 11px;
                                color: #999;
                                wrap: word-wrap;
                            }
                        }

                        if root.hierarchy-root == "" : Text {
                            text: "No taxonomy loaded";
                            color: #999;
                        }
                    }
                }
                }
            }

            // Center panel - Items List
            Rectangle {
                horizontal-stretch: 1;
                background: #333333;
                border-width: 1px;
                border-color: #ddd;

                VerticalBox {

                // Panel header
                Rectangle {
                    height: 30px;
                    background: #e8e8e8;

                    HorizontalBox {
                        padding: 6px;
                        spacing: 8px;

                        Text {
                            text: "Items (" + root.items-list.length + ")";
                            font-weight: 700;
                            vertical-alignment: center;
                            color: #000;
                        }

                        Rectangle {
                            horizontal-stretch: 1;
                        }

                        Button {
                            text: "Sort by Name";
                            clicked => { root.sort-by-name(); }
                        }
                    }
                }

                // Panel content
                VerticalBox {
                    if root.items-list.length > 0 : items-view := StandardListView {
                        model: root.items-list;
                        current-item <=> root.selected-item-index;
                        current-item-changed(index) => {
                            root.item-selected(index);
                        }
                    }

                    if root.items-list.length == 0 : VerticalBox {
                        alignment: center;

                        Text {
                            text: root.taxonomy-description != "" ? "No items in taxonomy" : "No taxonomy loaded";
                            color: #999;
                            horizontal-alignment: center;
                        }
                    }
                }
                }
            }

            // Right panel - Details/Edit
            Rectangle {
                width: 300px;
                background: #fafafa;
                border-width: 1px;
                border-color: #ddd;

                VerticalBox {

                // Panel header
                Rectangle {
                    height: 30px;
                    background: #e8e8e8;

                    HorizontalBox {
                        padding: 6px;

                        Text {
                            text: "Details";
                            font-weight: 700;
                            vertical-alignment: center;
                            color: #000;
                        }
                    }
                }

                // Panel content
                ScrollView {
                    VerticalBox {
                        padding: 12px;
                        spacing: 8px;

                        if root.selected-item-name != "" : VerticalBox {
                            spacing: 12px;

                            // Item name
                            VerticalBox {
                                spacing: 4px;

                                Text {
                                    text: "Name:";
                                    font-size: 10px;
                                    color: #666;
                                }

                                Text {
                                    text: root.selected-item-name;
                                    font-weight: 700;
                                    font-size: 14px;
                                    color: #000;
                                }
                            }

                            // Item path
                            if root.selected-item-path != "" : VerticalBox {
                                spacing: 4px;

                                Text {
                                    text: "Classification Path:";
                                    font-size: 10px;
                                    color: #666;
                                }

                                Text {
                                    text: root.selected-item-path;
                                    wrap: word-wrap;
                                    color: #000;
                                }
                            }

                            Rectangle {
                                height: 1px;
                                background: #ddd;
                            }

                            // Facets
                            if root.selected-item-facets != "" : VerticalBox {
                                spacing: 4px;

                                Text {
                                    text: "Facets:";
                                    font-size: 10px;
                                    color: #666;
                                }

                                Text {
                                    text: root.selected-item-facets;
                                    wrap: word-wrap;
                                    color: #000;
                                }
                            }

                            Rectangle {
                                height: 1px;
                                background: #ddd;
                            }

                            Text {
                                text: "Full editing will be implemented in Phase 6";
                                font-size: 11px;
                                color: #999;
                                wrap: word-wrap;
                            }
                        }

                        if root.selected-item-name == "" && root.taxonomy-description != "" : Text {
                            text: "Select an item to view details";
                            color: #999;
                        }

                        if root.taxonomy-description == "" : Text {
                            text: "No taxonomy loaded";
                            color: #999;
                        }
                    }
                }
                }
            }
        }

        // Bottom panel - Facet Filters
        Rectangle {
            height: 150px;
            background: #f5f5f5;
            border-width: 1px;
            border-color: #ddd;

            VerticalBox {
                // Panel header
                Rectangle {
                    height: 30px;
                    background: #e8e8e8;

                    HorizontalBox {
                        padding: 6px;
                        spacing: 8px;

                        Text {
                            text: "Filters";
                            font-weight: 700;
                            vertical-alignment: center;
                            color: #000;
                        }

                        Rectangle {
                            horizontal-stretch: 1;
                        }

                        Button {
                            text: "Apply Filters";
                            clicked => { root.apply-filters(); }
                        }

                        Button {
                            text: "Clear Filters";
                            clicked => { root.clear-filters(); }
                        }
                    }
                }

                // Panel content
                ScrollView {
                    VerticalBox {
                        padding: 12px;
                        spacing: 12px;

                        // Genus filter
                        if root.taxonomy-description != "" : VerticalBox {
                            spacing: 4px;

                            Text {
                                text: "Filter by Genus (comma-separated):";
                                font-size: 11px;
                                font-weight: 600;
                                color: #333;
                            }

                            LineEdit {
                                text <=> root.genus-filter-text;
                                placeholder-text: "e.g., Coffee, Tea";
                            }
                        }

                        // Facet filter
                        if root.taxonomy-description != "" : VerticalBox {
                            spacing: 4px;

                            Text {
                                text: "Filter by Facets (comma-separated, format: name=value):";
                                font-size: 11px;
                                font-weight: 600;
                                color: #333;
                            }

                            LineEdit {
                                text <=> root.facet-filter-text;
                                placeholder-text: "e.g., temperature=hot, caffeine_content=high";
                            }
                        }

                        // Active filters display
                        if root.active-filters-text != "" : VerticalBox {
                            spacing: 4px;

                            Text {
                                text: "Active Filters:";
                                font-size: 11px;
                                font-weight: 600;
                                color: #333;
                            }

                            Text {
                                text: root.active-filters-text;
                                color: #666;
                                wrap: word-wrap;
                            }
                        }

                        // Available facets info
                        if root.facet-dimensions-text != "" : VerticalBox {
                            spacing: 4px;

                            Text {
                                text: "Available Facets:";
                                font-size: 11px;
                                font-weight: 600;
                                color: #333;
                            }

                            Text {
                                text: root.facet-dimensions-text;
                                color: #999;
                                font-size: 10px;
                                wrap: word-wrap;
                            }
                        }
                    }
                }
            }
        }

        // Status bar
        Rectangle {
            height: 30px;
            background: #f0f0f0;

            HorizontalBox {
                padding: 8px;

                Text {
                    text: root.status-message;
                    vertical-alignment: center;
                    color: #000;
                }
            }
        }
    }
}
